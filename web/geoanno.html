<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://unpkg.com/chota@latest">
    </head>
    <body>
        <p> Supply an existing object via its URI. </p>
        <p> Then supply a latitude and longitude. </p>
        <p> Then Submit. </p>
        <label>Object URI</label><input id="objURI" type="text" />
        <label>Latitude</label><input id="lat" type="number" />
        <label>Longitude</label><input id="long" type="number" />
        <input type="button" onclick="leafy.demo.submitAnno(event)"
    </body>
    <script>
        
        /**
         * 
         *  https://iiif.lib.harvard.edu/manifests/drs:48309543
            https://purl.stanford.edu/rd447dz7630/iiif/manifest.json
            https://iiif.bodleian.ox.ac.uk/iiif/manifest/e32a277e-91e2-4a6d-8ba6-cc4bad230410.json
            http://devstore.rerum.io/v1/id/5c191794e4b05b14fb531f03

         */
        
        leafy.demo.submitAnno = async function(event){
            let targetURL = document.getElementById('objURL').value
            let targetObj =  await fetch(targetURL).then(response => response.json())
            let lat = document.getElementById('lat').value
            let long = document.getElementById('long').value
            let targetLabel = targetObj.label ? targetObj.label : targetObj.name? targetObj.name : "Unknown Label"
            let targetDescription = targetObj.description ? targetObj.description : "No Description"
            let demoAnno = 
            {
                "type":"Annotation",
                "@context":"http://www.w3.org/ns/anno.jsonld",
                "target":targetURL,   
                body:{
                    "type": "Feature", 
                    "properties": { 
                        "label": targetLabel, 
                        "description": targetDescription
                    }, 
                    "geometry": { 
                        "type": "Point", "coordinates": [long, lat] 
                    }
                },
                "madeByUser" : "BryGuy",
                "madeByApp"  : "MapDemo"
            }
            
            let createdObj = await fetch(leafy.URLS.CREATE, {
                method: "POST",
                mode: "cors",
                body: JSON.stringify(demoAnno)
            })
            .then(response => response.json())
            .then(newObj => return newObj.new_obj_state)
    
            console.log(createdObj)

        }
    </script>
</html>
